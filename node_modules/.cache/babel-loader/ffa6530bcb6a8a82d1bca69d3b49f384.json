{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar core = require('@octokit/core');\n\nvar authApp = require('@octokit/auth-app');\n\nvar oauthApp = require('@octokit/oauth-app');\n\nvar authUnauthenticated = require('@octokit/auth-unauthenticated');\n\nvar webhooks$1 = require('@octokit/webhooks');\n\nvar pluginPaginateRest = require('@octokit/plugin-paginate-rest');\n\nconst VERSION = \"13.0.5\";\n\nfunction webhooks(appOctokit, options // Explict return type for better debugability and performance,\n// see https://github.com/octokit/app.js/pull/201\n) {\n  return new webhooks$1.Webhooks({\n    secret: options.secret,\n    transform: async event => {\n      if (!(\"installation\" in event.payload) || typeof event.payload.installation !== \"object\") {\n        const octokit = new appOctokit.constructor({\n          authStrategy: authUnauthenticated.createUnauthenticatedAuth,\n          auth: {\n            reason: `\"installation\" key missing in webhook event payload`\n          }\n        });\n        return { ...event,\n          octokit: octokit\n        };\n      }\n\n      const installationId = event.payload.installation.id;\n      const octokit = await appOctokit.auth({\n        type: \"installation\",\n        installationId,\n\n        factory(auth) {\n          return new auth.octokit.constructor({ ...auth.octokitOptions,\n            authStrategy: authApp.createAppAuth,\n            ...{\n              auth: { ...auth,\n                installationId\n              }\n            }\n          });\n        }\n\n      });\n      return { ...event,\n        octokit: octokit\n      };\n    }\n  });\n}\n\nasync function getInstallationOctokit(app, installationId) {\n  return app.octokit.auth({\n    type: \"installation\",\n    installationId: installationId,\n\n    factory(auth) {\n      const options = { ...auth.octokitOptions,\n        authStrategy: authApp.createAppAuth,\n        ...{\n          auth: { ...auth,\n            installationId: installationId\n          }\n        }\n      };\n      return new auth.octokit.constructor(options);\n    }\n\n  });\n}\n\nfunction eachInstallationFactory(app) {\n  return Object.assign(eachInstallation.bind(null, app), {\n    iterator: eachInstallationIterator.bind(null, app)\n  });\n}\n\nasync function eachInstallation(app, callback) {\n  const i = eachInstallationIterator(app)[Symbol.asyncIterator]();\n  let result = await i.next();\n\n  while (!result.done) {\n    await callback(result.value);\n    result = await i.next();\n  }\n}\n\nfunction eachInstallationIterator(app) {\n  return {\n    async *[Symbol.asyncIterator]() {\n      const iterator = pluginPaginateRest.composePaginateRest.iterator(app.octokit, \"GET /app/installations\");\n\n      for await (const {\n        data: installations\n      } of iterator) {\n        for (const installation of installations) {\n          const installationOctokit = await getInstallationOctokit(app, installation.id);\n          yield {\n            octokit: installationOctokit,\n            installation\n          };\n        }\n      }\n    }\n\n  };\n}\n\nfunction eachRepositoryFactory(app) {\n  return Object.assign(eachRepository.bind(null, app), {\n    iterator: eachRepositoryIterator.bind(null, app)\n  });\n}\n\nasync function eachRepository(app, queryOrCallback, callback) {\n  const i = eachRepositoryIterator(app, callback ? queryOrCallback : undefined)[Symbol.asyncIterator]();\n  let result = await i.next();\n\n  while (!result.done) {\n    if (callback) {\n      await callback(result.value);\n    } else {\n      await queryOrCallback(result.value);\n    }\n\n    result = await i.next();\n  }\n}\n\nfunction singleInstallationIterator(app, installationId) {\n  return {\n    async *[Symbol.asyncIterator]() {\n      yield {\n        octokit: await app.getInstallationOctokit(installationId)\n      };\n    }\n\n  };\n}\n\nfunction eachRepositoryIterator(app, query) {\n  return {\n    async *[Symbol.asyncIterator]() {\n      const iterator = query ? singleInstallationIterator(app, query.installationId) : app.eachInstallation.iterator();\n\n      for await (const {\n        octokit\n      } of iterator) {\n        const repositoriesIterator = pluginPaginateRest.composePaginateRest.iterator(octokit, \"GET /installation/repositories\");\n\n        for await (const {\n          data: repositories\n        } of repositoriesIterator) {\n          for (const repository of repositories) {\n            yield {\n              octokit: octokit,\n              repository\n            };\n          }\n        }\n      }\n    }\n\n  };\n}\n\nfunction onUnhandledRequestDefault(request, response) {\n  response.writeHead(404, {\n    \"content-type\": \"application/json\"\n  });\n  response.end(JSON.stringify({\n    error: `Unknown route: ${request.method} ${request.url}`\n  }));\n}\n\nfunction noop() {}\n\nfunction createNodeMiddleware(app) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const log = Object.assign({\n    debug: noop,\n    info: noop,\n    warn: console.warn.bind(console),\n    error: console.error.bind(console)\n  }, options.log);\n  const optionsWithDefaults = {\n    onUnhandledRequest: onUnhandledRequestDefault,\n    pathPrefix: \"/api/github\",\n    ...options,\n    log\n  };\n  const webhooksMiddleware = webhooks$1.createNodeMiddleware(app.webhooks, {\n    path: optionsWithDefaults.pathPrefix + \"/webhooks\",\n    log,\n    onUnhandledRequest: optionsWithDefaults.onUnhandledRequest\n  });\n  const oauthMiddleware = oauthApp.createNodeMiddleware(app.oauth, {\n    pathPrefix: optionsWithDefaults.pathPrefix + \"/oauth\",\n    onUnhandledRequest: optionsWithDefaults.onUnhandledRequest\n  });\n  return middleware.bind(null, optionsWithDefaults, {\n    webhooksMiddleware,\n    oauthMiddleware\n  });\n}\n\nasync function middleware(options, _ref, request, response, next) {\n  let {\n    webhooksMiddleware,\n    oauthMiddleware\n  } = _ref;\n  const {\n    pathname\n  } = new URL(request.url, \"http://localhost\");\n\n  if (pathname === `${options.pathPrefix}/webhooks`) {\n    return webhooksMiddleware(request, response, next);\n  }\n\n  if (pathname.startsWith(`${options.pathPrefix}/oauth/`)) {\n    return oauthMiddleware(request, response, next);\n  }\n\n  const isExpressMiddleware = typeof next === \"function\";\n\n  if (isExpressMiddleware) {\n    // @ts-ignore `next` must be a function as we check two lines above\n    return next();\n  }\n\n  return options.onUnhandledRequest(request, response);\n}\n\nclass App {\n  constructor(options) {\n    const Octokit = options.Octokit || core.Octokit;\n    const authOptions = Object.assign({\n      appId: options.appId,\n      privateKey: options.privateKey\n    }, options.oauth ? {\n      clientId: options.oauth.clientId,\n      clientSecret: options.oauth.clientSecret\n    } : {});\n    this.octokit = new Octokit({\n      authStrategy: authApp.createAppAuth,\n      auth: authOptions,\n      log: options.log\n    });\n    this.log = Object.assign({\n      debug: () => {},\n      info: () => {},\n      warn: console.warn.bind(console),\n      error: console.error.bind(console)\n    }, options.log); // set app.webhooks depending on whether \"webhooks\" option has been passed\n\n    if (options.webhooks) {\n      // @ts-expect-error TODO: figure this out\n      this.webhooks = webhooks(this.octokit, options.webhooks);\n    } else {\n      Object.defineProperty(this, \"webhooks\", {\n        get() {\n          throw new Error(\"[@octokit/app] webhooks option not set\");\n        }\n\n      });\n    } // set app.oauth depending on whether \"oauth\" option has been passed\n\n\n    if (options.oauth) {\n      this.oauth = new oauthApp.OAuthApp({ ...options.oauth,\n        clientType: \"github-app\",\n        Octokit\n      });\n    } else {\n      Object.defineProperty(this, \"oauth\", {\n        get() {\n          throw new Error(\"[@octokit/app] oauth.clientId / oauth.clientSecret options are not set\");\n        }\n\n      });\n    }\n\n    this.getInstallationOctokit = getInstallationOctokit.bind(null, this);\n    this.eachInstallation = eachInstallationFactory(this);\n    this.eachRepository = eachRepositoryFactory(this);\n  }\n\n  static defaults(defaults) {\n    const AppWithDefaults = class extends this {\n      constructor() {\n        super({ ...defaults,\n          ...(arguments.length <= 0 ? undefined : arguments[0])\n        });\n      }\n\n    };\n    return AppWithDefaults;\n  }\n\n}\n\nApp.VERSION = VERSION;\nexports.App = App;\nexports.createNodeMiddleware = createNodeMiddleware;","map":{"version":3,"mappings":"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","names":["VERSION","webhooks","appOctokit","options","Webhooks","secret","transform","event","payload","installation","octokit","constructor","authStrategy","createUnauthenticatedAuth","auth","reason","installationId","id","type","factory","octokitOptions","createAppAuth","getInstallationOctokit","app","eachInstallationFactory","Object","assign","eachInstallation","bind","iterator","eachInstallationIterator","callback","i","Symbol","asyncIterator","result","next","done","value","composePaginateRest","data","installations","installationOctokit","eachRepositoryFactory","eachRepository","eachRepositoryIterator","queryOrCallback","undefined","singleInstallationIterator","query","repositoriesIterator","repositories","repository","onUnhandledRequestDefault","request","response","writeHead","end","JSON","stringify","error","method","url","noop","createNodeMiddleware","log","debug","info","warn","console","optionsWithDefaults","onUnhandledRequest","pathPrefix","webhooksMiddleware","webhooksNodeMiddleware","path","oauthMiddleware","oauthNodeMiddleware","oauth","middleware","pathname","URL","startsWith","isExpressMiddleware","App","Octokit","OctokitCore","authOptions","appId","privateKey","clientId","clientSecret","defineProperty","get","Error","OAuthApp","clientType","defaults","AppWithDefaults"],"sources":["/home/hosainy/documents/oden-project/repos/sas-interview-assignment/node_modules/@octokit/app/dist-src/version.js","/home/hosainy/documents/oden-project/repos/sas-interview-assignment/node_modules/@octokit/app/dist-src/webhooks.js","/home/hosainy/documents/oden-project/repos/sas-interview-assignment/node_modules/@octokit/app/dist-src/get-installation-octokit.js","/home/hosainy/documents/oden-project/repos/sas-interview-assignment/node_modules/@octokit/app/dist-src/each-installation.js","/home/hosainy/documents/oden-project/repos/sas-interview-assignment/node_modules/@octokit/app/dist-src/each-repository.js","/home/hosainy/documents/oden-project/repos/sas-interview-assignment/node_modules/@octokit/app/dist-src/middleware/node/on-unhandled-request-default.js","/home/hosainy/documents/oden-project/repos/sas-interview-assignment/node_modules/@octokit/app/dist-src/middleware/node/index.js","/home/hosainy/documents/oden-project/repos/sas-interview-assignment/node_modules/@octokit/app/dist-src/index.js"],"sourcesContent":["export const VERSION = \"13.0.5\";\n","import { createAppAuth } from \"@octokit/auth-app\";\nimport { createUnauthenticatedAuth } from \"@octokit/auth-unauthenticated\";\nimport { Webhooks } from \"@octokit/webhooks\";\nexport function webhooks(appOctokit, options\n// Explict return type for better debugability and performance,\n// see https://github.com/octokit/app.js/pull/201\n) {\n    return new Webhooks({\n        secret: options.secret,\n        transform: async (event) => {\n            if (!(\"installation\" in event.payload) ||\n                typeof event.payload.installation !== \"object\") {\n                const octokit = new appOctokit.constructor({\n                    authStrategy: createUnauthenticatedAuth,\n                    auth: {\n                        reason: `\"installation\" key missing in webhook event payload`,\n                    },\n                });\n                return {\n                    ...event,\n                    octokit: octokit,\n                };\n            }\n            const installationId = event.payload.installation.id;\n            const octokit = (await appOctokit.auth({\n                type: \"installation\",\n                installationId,\n                factory(auth) {\n                    return new auth.octokit.constructor({\n                        ...auth.octokitOptions,\n                        authStrategy: createAppAuth,\n                        ...{\n                            auth: {\n                                ...auth,\n                                installationId,\n                            },\n                        },\n                    });\n                },\n            }));\n            return {\n                ...event,\n                octokit: octokit,\n            };\n        },\n    });\n}\n","import { createAppAuth } from \"@octokit/auth-app\";\nexport async function getInstallationOctokit(app, installationId) {\n    return app.octokit.auth({\n        type: \"installation\",\n        installationId: installationId,\n        factory(auth) {\n            const options = {\n                ...auth.octokitOptions,\n                authStrategy: createAppAuth,\n                ...{ auth: { ...auth, installationId: installationId } },\n            };\n            return new auth.octokit.constructor(options);\n        },\n    });\n}\n","import { composePaginateRest } from \"@octokit/plugin-paginate-rest\";\nimport { getInstallationOctokit } from \"./get-installation-octokit\";\nexport function eachInstallationFactory(app) {\n    return Object.assign(eachInstallation.bind(null, app), {\n        iterator: eachInstallationIterator.bind(null, app),\n    });\n}\nexport async function eachInstallation(app, callback) {\n    const i = eachInstallationIterator(app)[Symbol.asyncIterator]();\n    let result = await i.next();\n    while (!result.done) {\n        await callback(result.value);\n        result = await i.next();\n    }\n}\nexport function eachInstallationIterator(app) {\n    return {\n        async *[Symbol.asyncIterator]() {\n            const iterator = composePaginateRest.iterator(app.octokit, \"GET /app/installations\");\n            for await (const { data: installations } of iterator) {\n                for (const installation of installations) {\n                    const installationOctokit = await getInstallationOctokit(app, installation.id);\n                    yield { octokit: installationOctokit, installation };\n                }\n            }\n        },\n    };\n}\n","import { composePaginateRest } from \"@octokit/plugin-paginate-rest\";\nexport function eachRepositoryFactory(app) {\n    return Object.assign(eachRepository.bind(null, app), {\n        iterator: eachRepositoryIterator.bind(null, app),\n    });\n}\nexport async function eachRepository(app, queryOrCallback, callback) {\n    const i = eachRepositoryIterator(app, callback ? queryOrCallback : undefined)[Symbol.asyncIterator]();\n    let result = await i.next();\n    while (!result.done) {\n        if (callback) {\n            await callback(result.value);\n        }\n        else {\n            await queryOrCallback(result.value);\n        }\n        result = await i.next();\n    }\n}\nfunction singleInstallationIterator(app, installationId) {\n    return {\n        async *[Symbol.asyncIterator]() {\n            yield {\n                octokit: await app.getInstallationOctokit(installationId),\n            };\n        },\n    };\n}\nexport function eachRepositoryIterator(app, query) {\n    return {\n        async *[Symbol.asyncIterator]() {\n            const iterator = query\n                ? singleInstallationIterator(app, query.installationId)\n                : app.eachInstallation.iterator();\n            for await (const { octokit } of iterator) {\n                const repositoriesIterator = composePaginateRest.iterator(octokit, \"GET /installation/repositories\");\n                for await (const { data: repositories } of repositoriesIterator) {\n                    for (const repository of repositories) {\n                        yield { octokit: octokit, repository };\n                    }\n                }\n            }\n        },\n    };\n}\n","export function onUnhandledRequestDefault(request, response) {\n    response.writeHead(404, {\n        \"content-type\": \"application/json\",\n    });\n    response.end(JSON.stringify({\n        error: `Unknown route: ${request.method} ${request.url}`,\n    }));\n}\n","import { createNodeMiddleware as oauthNodeMiddleware } from \"@octokit/oauth-app\";\nimport { createNodeMiddleware as webhooksNodeMiddleware } from \"@octokit/webhooks\";\nimport { onUnhandledRequestDefault } from \"./on-unhandled-request-default\";\nfunction noop() { }\nexport function createNodeMiddleware(app, options = {}) {\n    const log = Object.assign({\n        debug: noop,\n        info: noop,\n        warn: console.warn.bind(console),\n        error: console.error.bind(console),\n    }, options.log);\n    const optionsWithDefaults = {\n        onUnhandledRequest: onUnhandledRequestDefault,\n        pathPrefix: \"/api/github\",\n        ...options,\n        log,\n    };\n    const webhooksMiddleware = webhooksNodeMiddleware(app.webhooks, {\n        path: optionsWithDefaults.pathPrefix + \"/webhooks\",\n        log,\n        onUnhandledRequest: optionsWithDefaults.onUnhandledRequest,\n    });\n    const oauthMiddleware = oauthNodeMiddleware(app.oauth, {\n        pathPrefix: optionsWithDefaults.pathPrefix + \"/oauth\",\n        onUnhandledRequest: optionsWithDefaults.onUnhandledRequest,\n    });\n    return middleware.bind(null, optionsWithDefaults, {\n        webhooksMiddleware,\n        oauthMiddleware,\n    });\n}\nexport async function middleware(options, { webhooksMiddleware, oauthMiddleware }, request, response, next) {\n    const { pathname } = new URL(request.url, \"http://localhost\");\n    if (pathname === `${options.pathPrefix}/webhooks`) {\n        return webhooksMiddleware(request, response, next);\n    }\n    if (pathname.startsWith(`${options.pathPrefix}/oauth/`)) {\n        return oauthMiddleware(request, response, next);\n    }\n    const isExpressMiddleware = typeof next === \"function\";\n    if (isExpressMiddleware) {\n        // @ts-ignore `next` must be a function as we check two lines above\n        return next();\n    }\n    return options.onUnhandledRequest(request, response);\n}\n","import { Octokit as OctokitCore } from \"@octokit/core\";\nimport { createAppAuth } from \"@octokit/auth-app\";\nimport { OAuthApp } from \"@octokit/oauth-app\";\nimport { VERSION } from \"./version\";\nimport { webhooks } from \"./webhooks\";\nimport { eachInstallationFactory } from \"./each-installation\";\nimport { eachRepositoryFactory } from \"./each-repository\";\nimport { getInstallationOctokit } from \"./get-installation-octokit\";\nexport class App {\n    constructor(options) {\n        const Octokit = (options.Octokit ||\n            OctokitCore);\n        const authOptions = Object.assign({\n            appId: options.appId,\n            privateKey: options.privateKey,\n        }, options.oauth\n            ? {\n                clientId: options.oauth.clientId,\n                clientSecret: options.oauth.clientSecret,\n            }\n            : {});\n        this.octokit = new Octokit({\n            authStrategy: createAppAuth,\n            auth: authOptions,\n            log: options.log,\n        });\n        this.log = Object.assign({\n            debug: () => { },\n            info: () => { },\n            warn: console.warn.bind(console),\n            error: console.error.bind(console),\n        }, options.log);\n        // set app.webhooks depending on whether \"webhooks\" option has been passed\n        if (options.webhooks) {\n            // @ts-expect-error TODO: figure this out\n            this.webhooks = webhooks(this.octokit, options.webhooks);\n        }\n        else {\n            Object.defineProperty(this, \"webhooks\", {\n                get() {\n                    throw new Error(\"[@octokit/app] webhooks option not set\");\n                },\n            });\n        }\n        // set app.oauth depending on whether \"oauth\" option has been passed\n        if (options.oauth) {\n            this.oauth = new OAuthApp({\n                ...options.oauth,\n                clientType: \"github-app\",\n                Octokit,\n            });\n        }\n        else {\n            Object.defineProperty(this, \"oauth\", {\n                get() {\n                    throw new Error(\"[@octokit/app] oauth.clientId / oauth.clientSecret options are not set\");\n                },\n            });\n        }\n        this.getInstallationOctokit = getInstallationOctokit.bind(null, this);\n        this.eachInstallation = eachInstallationFactory(this);\n        this.eachRepository = eachRepositoryFactory(this);\n    }\n    static defaults(defaults) {\n        const AppWithDefaults = class extends this {\n            constructor(...args) {\n                super({\n                    ...defaults,\n                    ...args[0],\n                });\n            }\n        };\n        return AppWithDefaults;\n    }\n}\nApp.VERSION = VERSION;\nexport { createNodeMiddleware } from \"./middleware/node/index\";\n"]},"metadata":{},"sourceType":"script"}